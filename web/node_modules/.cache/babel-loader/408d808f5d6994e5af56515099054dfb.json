{"ast":null,"code":"import \"../../public/assets/css/chat.css\";\nimport \"../../public/assets/emoji/emojis.css\";\nimport \"../../public/assets/emoji/DisMojiPicker.js\";\nimport axios from \"axios\";\nimport swal from \"sweetalert2\";\nimport store from \"../vuex/store\";\nexport default {\n  data() {\n    return {\n      attachment: null,\n      message: \"\",\n      email: this.$route.params.email,\n      page: 0,\n      receiver: null,\n      base64Str: \"\",\n      downloadFileName: \"\",\n      btnLoadMoreClass: \"fa fa-repeat\",\n      hasMoreMessages: true,\n      selectedMessageId: 0,\n      selectedMessageText: \"\",\n      isShowingBookmarked: false,\n      password: \"\"\n    };\n  },\n\n  computed: {\n    messages() {\n      return store.getters.getMessages;\n    }\n\n  },\n  methods: {\n    showBookmarkedMessages: async function () {\n      store.commit(\"setMessages\", []);\n\n      if (this.isShowingBookmarked) {\n        this.page = 0;\n        this.getData();\n        this.isShowingBookmarked = false;\n      } else {\n        const formData = new FormData();\n        formData.append(\"email\", this.email);\n        formData.append(\"password\", this.password);\n        const response = await axios.post(this.$apiURL + \"/chat/getBookmarked\", formData, {\n          headers: this.$headers\n        });\n\n        if (response.data.status == \"success\") {\n          for (let a = 0; a < response.data.data.length; a++) {\n            store.commit(\"prependMessage\", response.data.data[a]);\n          }\n\n          this.attachEventListeners();\n        } else {\n          swal.fire(\"Error\", response.data.message, \"error\");\n        }\n\n        this.isShowingBookmarked = true;\n      }\n    },\n    copyMessage: function () {\n      navigator.clipboard.writeText(this.selectedMessageText);\n    },\n    bookmarkMessage: async function () {\n      const target = event.target;\n      const formData = new FormData();\n      formData.append(\"_id\", this.selectedMessageId);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/bookmark\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        for (let a = 0; a < this.messages.length; a++) {\n          if (this.messages[a]._id == this.selectedMessageId) {\n            this.messages[a] = response.data.newMessage;\n            break;\n          }\n        }\n\n        store.commit(\"setMessages\", this.messages);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    hideMoreOptions: function () {\n      document.getElementById(\"contextMenu\").style.display = \"none\";\n    },\n    showMoreOptions: function (msg) {\n      const isMyMessage = event.target.getAttribute(\"is-my-message\");\n      this.selectedMessageId = msg._id;\n      this.selectedMessageText = msg.message;\n      var menu = document.getElementById(\"contextMenu\");\n      menu.style.display = \"block\";\n\n      if (isMyMessage == \"true\") {\n        menu.style.left = event.pageX - 200 + \"px\";\n      } else {\n        menu.style.left = event.pageX + \"px\";\n      }\n\n      menu.style.top = event.pageY + \"px\";\n      document.querySelector(\".bookmark i\").className = \"fa fa-bookmark-o\";\n\n      if (msg.bookmarkBy) {\n        document.querySelector(\".bookmark i\").className = \"fa fa-bookmark\";\n      }\n    },\n    attachEventListeners: function () {\n      const self = this;\n      document.addEventListener(\"click\", function (e) {\n        const moreOptions = document.querySelectorAll(\".more-options\");\n        let isClickedMoreOptions = true;\n\n        for (let a = 0; a < moreOptions.length; a++) {\n          if (moreOptions[a].contains(e.target)) {\n            isClickedMoreOptions = true;\n            break;\n          } else {\n            isClickedMoreOptions = false;\n          }\n        }\n\n        if (!isClickedMoreOptions) {\n          self.hideMoreOptions();\n        }\n      });\n    },\n    getChatPersonPicture: function (user) {\n      if (typeof user.picture !== \"undefined\" && user.picture != \"\") {\n        return this.$apiURL + \"/\" + user.picture;\n      }\n\n      return \"../../assets/img/avatar2.png\";\n    },\n    getPicture: function (user) {\n      if (typeof user.picture !== \"undefined\") {\n        return this.$apiURL + \"/\" + user.picture;\n      }\n\n      return \"../../assets/img/avatar7.png\";\n    },\n    doSearch: async function () {\n      const form = event.target;\n      const formData = new FormData(form);\n      formData.append(\"email\", this.email);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/search\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        store.commit(\"setMessages\", []);\n\n        for (let a = 0; a < response.data.data.length; a++) {\n          store.commit(\"prependMessage\", response.data.data[a]);\n        }\n\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    downloadAttachment: async function () {\n      const anchor = event.target;\n      const id = anchor.getAttribute(\"data-id\");\n      const originalHtml = anchor.innerHTML;\n      anchor.innerHTML = \"Loading...\";\n      const formData = new FormData();\n      formData.append(\"messageId\", id);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/attachment\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        this.base64Str = response.data.base64Str;\n        this.downloadFileName = response.data.fileName;\n        const btnDownloadAttachment = this.$refs[\"btnDownloadAttachment\"];\n        setTimeout(function () {\n          btnDownloadAttachment.click();\n          anchor.innerHTML = originalHtml;\n        }, 500);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    fileSelected: function () {\n      const files = event.target.files;\n\n      if (files.length > 0) {\n        this.attachment = files[0];\n      }\n    },\n    selectFile: function () {\n      document.getElementById(\"attachment\").click();\n    },\n    getMessageTime: function (time) {\n      const dateObj = new Date(time);\n      let timeStr = dateObj.getFullYear() + \"-\" + (dateObj.getMonth() + 1) + \"-\" + dateObj.getDate() + \" \" + dateObj.getHours() + \":\" + dateObj.getMinutes() + \":\" + dateObj.getSeconds();\n      return timeStr;\n    },\n    loadMore: function () {\n      this.btnLoadMoreClass = \"fa fa-spinner fa-spin\";\n      this.page++;\n      this.getData();\n    },\n    getData: async function () {\n      if (this.email == null) {\n        return;\n      }\n\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"page\", this.page);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/fetch\", formData, {\n        headers: this.$headers\n      });\n      this.btnLoadMoreClass = \"fa fa-repeat\";\n\n      if (response.data.status == \"success\") {\n        for (let a = 0; a < response.data.messages.length; a++) {\n          store.commit(\"prependMessage\", response.data.messages[a]);\n        }\n\n        this.hasMoreMessages = response.data.messages.length == 0 ? false : true;\n        this.receiver = response.data.receiver;\n        this.user = response.data.user;\n        this.isArchive = response.data.isArchive;\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    sendMessage: async function () {\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"message\", this.message);\n      formData.append(\"password\", this.password);\n\n      if (this.attachment != null) {\n        formData.append(\"attachment\", this.attachment);\n      }\n\n      const response = await axios.post(this.$apiURL + \"/chat/send\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        this.message = \"\";\n        this.attachment = null;\n        document.getElementById(\"attachment\").value = null;\n        store.commit(\"appendMessage\", response.data.messageObject);\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    initializeEmoji: function () {\n      const self = this;\n      $(\"#emojis\").disMojiPicker();\n      twemoji.parse(document.body);\n      $(\"#emojis\").picker(function (emoji) {\n        self.message += emoji;\n      });\n    }\n  },\n\n  mounted() {\n    this.getData();\n    this.initializeEmoji();\n  },\n\n  watch: {\n    $route: function (to, from) {\n      if (from.href.includes(\"/chat/\")) {\n        store.commit(\"setMessages\", []);\n      }\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","swal","store","data","attachment","message","email","$route","params","page","receiver","base64Str","downloadFileName","btnLoadMoreClass","hasMoreMessages","selectedMessageId","selectedMessageText","isShowingBookmarked","password","computed","messages","getters","getMessages","methods","showBookmarkedMessages","commit","getData","formData","FormData","append","response","post","$apiURL","headers","$headers","status","a","length","attachEventListeners","fire","copyMessage","navigator","clipboard","writeText","bookmarkMessage","target","event","_id","newMessage","hideMoreOptions","document","getElementById","style","display","showMoreOptions","msg","isMyMessage","getAttribute","menu","left","pageX","top","pageY","querySelector","className","bookmarkBy","self","addEventListener","e","moreOptions","querySelectorAll","isClickedMoreOptions","contains","getChatPersonPicture","user","picture","getPicture","doSearch","form","downloadAttachment","anchor","id","originalHtml","innerHTML","fileName","btnDownloadAttachment","$refs","setTimeout","click","fileSelected","files","selectFile","getMessageTime","time","dateObj","Date","timeStr","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","loadMore","isArchive","sendMessage","value","messageObject","initializeEmoji","$","disMojiPicker","twemoji","parse","body","picker","emoji","mounted","watch","to","from","href","includes"],"sourceRoot":"","sources":["D:\\Download\\Compressed\\chat\\web\\src\\components\\ChatComponent.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"row clearfix\">\n      <div class=\"col-lg-12\">\n        <div class=\"card chat-app\">\n          <div class=\"chat\">\n            <div class=\"chat-header clearfix\">\n              <div class=\"row\">\n                <div class=\"col-lg-6\">\n                  <a\n                    href=\"javascript:void(0);\"\n                    data-toggle=\"modal\"\n                    data-target=\"#view_info\"\n                  >\n                    <img\n                      v-if=\"receiver != null\"\n                      v-bind:src=\"getChatPersonPicture(receiver)\"\n                      alt=\"avatar\"\n                      style=\"width: 50px\"\n                    />\n                  </a>\n\n                  <div class=\"chat-about\">\n                    <h6\n                      class=\"m-b-0 text-white\"\n                      v-if=\"receiver != null\"\n                      v-text=\"receiver.name\"\n                      style=\"margin-bottom: 0px; position: relative; top: 10px\"\n                    ></h6>\n                  </div>\n                </div>\n\n                <div class=\"col-lg-6 hidden-sm text-right text-white\">\n                  <button\n                    type=\"button\"\n                    class=\"btn btn-primary\"\n                    style=\"margin-right: 10px\"\n                    v-on:click=\"showBookmarkedMessages\"\n                    v-text=\"isShowingBookmarked ? 'All messages' : 'Bookmarked messages'\"\n                  ></button>\n\n                  <form style=\"display: inline-block\" v-on:submit.prevent=\"doSearch\">\n                    <div class=\"form-group\" style=\"display: flex\">\n                      <input type=\"search\" name=\"search\" autocomplete=\"off\" />\n                      <button type=\"submit\" class=\"btn btn-link\">\n                        <i class=\"fa fa-search\"></i>\n                      </button>\n                    </div>\n                  </form>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"chat-history\">\n              <ul class=\"m-b-0\">\n                <li style=\"text-align: center\">\n                  <i\n                    v-bind:class=\"btnLoadMoreClass + ' btnLoadMore'\"\n                    v-on:click=\"loadMore\"\n                    v-if=\"hasMoreMessages\"\n                  ></i>\n                </li>\n\n                <li v-for=\"msg in messages\" class=\"clearfix\" v-bind:key=\"msg._id\">\n                  <div\n                    class=\"more-options\"\n                    v-on:click=\"showMoreOptions(msg)\"\n                    v-bind:is-my-message=\"user != null && user.email == msg.sender.email\"\n                    v-bind:style=\"\n                      user != null && user.email == msg.sender.email\n                        ? { float: 'right' }\n                        : { position: 'relative', top: '15px' }\n                    \"\n                  ></div>\n\n                  <div\n                    v-bind:class=\"\n                      'message ' +\n                      (user != null && user.email == msg.sender.email\n                        ? 'my-message float-right'\n                        : 'other-message')\n                    \"\n                  >\n                    <p\n                      v-text=\"msg.message\"\n                      v-bind:class=\"\n                        user != null && user.email == msg.sender.email ? 'text-right' : ''\n                      \"\n                      style=\"margin-bottom: 0px\"\n                    ></p>\n\n                    <template v-if=\"msg.attachment != null\">\n                      <a\n                        href=\"javascript:void(0)\"\n                        v-bind:data-id=\"msg._id\"\n                        v-on:click.prevent=\"downloadAttachment\"\n                        v-text=\"msg.attachment.displayName\"\n                        class=\"text-info\"\n                        target=\"_blank\"\n                      ></a>\n                    </template>\n                  </div>\n\n                  <div\n                    v-bind:class=\"\n                      'message-data ' +\n                      (user != null && user.email == msg.sender.email\n                        ? 'float-right'\n                        : '')\n                    \"\n                  >\n                    <span\n                      class=\"message-data-time text-white\"\n                      v-text=\"getMessageTime(msg.createdAt)\"\n                      style=\"margin-right: 10px\"\n                    ></span>\n                    <img\n                      v-bind:src=\"getPicture(msg.sender)\"\n                      alt=\"avatar\"\n                      style=\"width: 100px\"\n                    />\n                  </div>\n                </li>\n              </ul>\n            </div>\n\n            <div class=\"chat-message clearfix\">\n              <div class=\"input-group mb-0\">\n                <div class=\"input-group mb-3\">\n                  <input\n                    type=\"text\"\n                    class=\"form-control send-message\"\n                    placeholder=\"Enter text here...\"\n                    v-model=\"message\"\n                  />\n\n                  <button class=\"btn btn-primary\" v-on:click=\"sendMessage\" type=\"button\">\n                    Send\n                  </button>\n                </div>\n              </div>\n\n              <div id=\"emojis\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <a\n    v-bind:href=\"base64Str\"\n    ref=\"btnDownloadAttachment\"\n    v-bind:download=\"downloadFileName\"\n  ></a>\n\n  <div id=\"contextMenu\" class=\"context-menu\" style=\"display: none\">\n    <ul class=\"menu\">\n      <li class=\"copy\">\n        <a href=\"javascript:void(0)\" v-on:click=\"copyMessage\"\n          ><i class=\"fa fa-copy\" aria-hidden=\"true\"></i> Copy</a\n        >\n      </li>\n\n      <li class=\"bookmark\">\n        <a href=\"javascript:void(0)\" v-on:click=\"bookmarkMessage\"\n          ><i class=\"fa fa-bookmark-o\" aria-hidden=\"true\"></i> Bookmark</a\n        >\n      </li>\n    </ul>\n  </div>\n</template>\n\n<script>\nimport \"../../public/assets/css/chat.css\";\nimport \"../../public/assets/emoji/emojis.css\";\nimport \"../../public/assets/emoji/DisMojiPicker.js\";\n\nimport axios from \"axios\";\nimport swal from \"sweetalert2\";\nimport store from \"../vuex/store\";\n\nexport default {\n  data() {\n    return {\n      attachment: null,\n      message: \"\",\n      email: this.$route.params.email,\n      page: 0,\n      receiver: null,\n      base64Str: \"\",\n      downloadFileName: \"\",\n      btnLoadMoreClass: \"fa fa-repeat\",\n      hasMoreMessages: true,\n      selectedMessageId: 0,\n      selectedMessageText: \"\",\n      isShowingBookmarked: false,\n      password: \"\",\n    };\n  },\n\n  computed: {\n    messages() {\n      return store.getters.getMessages;\n    },\n  },\n\n  methods: {\n    showBookmarkedMessages: async function () {\n      store.commit(\"setMessages\", []);\n\n      if (this.isShowingBookmarked) {\n        this.page = 0;\n        this.getData();\n        this.isShowingBookmarked = false;\n      } else {\n        const formData = new FormData();\n        formData.append(\"email\", this.email);\n        formData.append(\"password\", this.password);\n\n        const response = await axios.post(\n          this.$apiURL + \"/chat/getBookmarked\",\n          formData,\n          {\n            headers: this.$headers,\n          }\n        );\n        if (response.data.status == \"success\") {\n          for (let a = 0; a < response.data.data.length; a++) {\n            store.commit(\"prependMessage\", response.data.data[a]);\n          }\n          this.attachEventListeners();\n        } else {\n          swal.fire(\"Error\", response.data.message, \"error\");\n        }\n        this.isShowingBookmarked = true;\n      }\n    },\n\n    copyMessage: function () {\n      navigator.clipboard.writeText(this.selectedMessageText);\n    },\n    bookmarkMessage: async function () {\n      const target = event.target;\n      const formData = new FormData();\n      formData.append(\"_id\", this.selectedMessageId);\n      formData.append(\"password\", this.password);\n\n      const response = await axios.post(this.$apiURL + \"/chat/bookmark\", formData, {\n        headers: this.$headers,\n      });\n\n      if (response.data.status == \"success\") {\n        for (let a = 0; a < this.messages.length; a++) {\n          if (this.messages[a]._id == this.selectedMessageId) {\n            this.messages[a] = response.data.newMessage;\n            break;\n          }\n        }\n        store.commit(\"setMessages\", this.messages);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n\n    hideMoreOptions: function () {\n      document.getElementById(\"contextMenu\").style.display = \"none\";\n    },\n\n    showMoreOptions: function (msg) {\n      const isMyMessage = event.target.getAttribute(\"is-my-message\");\n      this.selectedMessageId = msg._id;\n      this.selectedMessageText = msg.message;\n\n      var menu = document.getElementById(\"contextMenu\");\n      menu.style.display = \"block\";\n      if (isMyMessage == \"true\") {\n        menu.style.left = event.pageX - 200 + \"px\";\n      } else {\n        menu.style.left = event.pageX + \"px\";\n      }\n      menu.style.top = event.pageY + \"px\";\n\n      document.querySelector(\".bookmark i\").className = \"fa fa-bookmark-o\";\n\n      if (msg.bookmarkBy) {\n        document.querySelector(\".bookmark i\").className = \"fa fa-bookmark\";\n      }\n    },\n\n    attachEventListeners: function () {\n      const self = this;\n\n      document.addEventListener(\"click\", function (e) {\n        const moreOptions = document.querySelectorAll(\".more-options\");\n        let isClickedMoreOptions = true;\n        for (let a = 0; a < moreOptions.length; a++) {\n          if (moreOptions[a].contains(e.target)) {\n            isClickedMoreOptions = true;\n            break;\n          } else {\n            isClickedMoreOptions = false;\n          }\n        }\n        if (!isClickedMoreOptions) {\n          self.hideMoreOptions();\n        }\n      });\n    },\n\n    getChatPersonPicture: function (user) {\n      if (typeof user.picture !== \"undefined\" && user.picture != \"\") {\n        return this.$apiURL + \"/\" + user.picture;\n      }\n      return \"../../assets/img/avatar2.png\";\n    },\n\n    getPicture: function (user) {\n      if (typeof user.picture !== \"undefined\") {\n        return this.$apiURL + \"/\" + user.picture;\n      }\n      return \"../../assets/img/avatar7.png\";\n    },\n\n    doSearch: async function () {\n      const form = event.target;\n      const formData = new FormData(form);\n      formData.append(\"email\", this.email);\n      formData.append(\"password\", this.password);\n\n      const response = await axios.post(this.$apiURL + \"/chat/search\", formData, {\n        headers: this.$headers,\n      });\n\n      if (response.data.status == \"success\") {\n        store.commit(\"setMessages\", []);\n        for (let a = 0; a < response.data.data.length; a++) {\n          store.commit(\"prependMessage\", response.data.data[a]);\n        }\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n\n    downloadAttachment: async function () {\n      const anchor = event.target;\n      const id = anchor.getAttribute(\"data-id\");\n      const originalHtml = anchor.innerHTML;\n      anchor.innerHTML = \"Loading...\";\n\n      const formData = new FormData();\n      formData.append(\"messageId\", id);\n      formData.append(\"password\", this.password);\n\n      const response = await axios.post(this.$apiURL + \"/chat/attachment\", formData, {\n        headers: this.$headers,\n      });\n      if (response.data.status == \"success\") {\n        this.base64Str = response.data.base64Str;\n        this.downloadFileName = response.data.fileName;\n\n        const btnDownloadAttachment = this.$refs[\"btnDownloadAttachment\"];\n        setTimeout(function () {\n          btnDownloadAttachment.click();\n          anchor.innerHTML = originalHtml;\n        }, 500);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n\n    fileSelected: function () {\n      const files = event.target.files;\n      if (files.length > 0) {\n        this.attachment = files[0];\n      }\n    },\n    selectFile: function () {\n      document.getElementById(\"attachment\").click();\n    },\n    getMessageTime: function (time) {\n      const dateObj = new Date(time);\n      let timeStr =\n        dateObj.getFullYear() +\n        \"-\" +\n        (dateObj.getMonth() + 1) +\n        \"-\" +\n        dateObj.getDate() +\n        \" \" +\n        dateObj.getHours() +\n        \":\" +\n        dateObj.getMinutes() +\n        \":\" +\n        dateObj.getSeconds();\n      return timeStr;\n    },\n    loadMore: function () {\n      this.btnLoadMoreClass = \"fa fa-spinner fa-spin\";\n      this.page++;\n      this.getData();\n    },\n    getData: async function () {\n      if (this.email == null) {\n        return;\n      }\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"page\", this.page);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/fetch\", formData, {\n        headers: this.$headers,\n      });\n\n      this.btnLoadMoreClass = \"fa fa-repeat\";\n\n      if (response.data.status == \"success\") {\n        for (let a = 0; a < response.data.messages.length; a++) {\n          store.commit(\"prependMessage\", response.data.messages[a]);\n        }\n        this.hasMoreMessages = response.data.messages.length == 0 ? false : true;\n        this.receiver = response.data.receiver;\n        this.user = response.data.user;\n        this.isArchive = response.data.isArchive;\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n\n    sendMessage: async function () {\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"message\", this.message);\n      formData.append(\"password\", this.password);\n      if (this.attachment != null) {\n        formData.append(\"attachment\", this.attachment);\n      }\n\n      const response = await axios.post(this.$apiURL + \"/chat/send\", formData, {\n        headers: this.$headers,\n      });\n\n      if (response.data.status == \"success\") {\n        this.message = \"\";\n\n        this.attachment = null;\n        document.getElementById(\"attachment\").value = null;\n\n        store.commit(\"appendMessage\", response.data.messageObject);\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n\n    initializeEmoji: function () {\n      const self = this;\n      $(\"#emojis\").disMojiPicker();\n      twemoji.parse(document.body);\n      $(\"#emojis\").picker(function (emoji) {\n        self.message += emoji;\n      });\n    },\n  },\n\n  mounted() {\n    this.getData();\n    this.initializeEmoji();\n  },\n\n  watch: {\n    $route: function (to, from) {\n      if (from.href.includes(\"/chat/\")) {\n        store.commit(\"setMessages\", []);\n      }\n    },\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module"}