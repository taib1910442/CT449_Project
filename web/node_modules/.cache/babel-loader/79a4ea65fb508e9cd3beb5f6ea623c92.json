{"ast":null,"code":"import \"../../public/assets/css/chat.css\";\nimport \"../../public/assets/emoji/emojis.css\";\nimport \"../../public/assets/emoji/DisMojiPicker.js\";\nimport axios from \"axios\";\nimport swal from \"sweetalert2\";\nimport store from \"../vuex/store\";\nexport default {\n  data() {\n    return {\n      attachment: null,\n      message: \"\",\n      email: this.$route.params.email,\n      page: 0,\n      receiver: null,\n      base64Str: \"\",\n      downloadFileName: \"\",\n      btnLoadMoreClass: \"fa fa-repeat\",\n      hasMoreMessages: true,\n      selectedMessageId: 0,\n      selectedMessageText: \"\",\n      isShowingBookmarked: false,\n      isArchive: false,\n      password: \"\"\n    };\n  },\n\n  computed: {\n    messages() {\n      return store.getters.getMessages;\n    }\n\n  },\n  methods: {\n    verifyArchivedPassword: async function () {\n      const self = this;\n      const form = event.target;\n      const formData = new FormData(form);\n      formData.append(\"email\", this.email);\n      const response = await axios.post(this.$apiURL + \"/chat/verifyArchivedPassword\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        this.isArchive = response.data.isArchive;\n        this.password = form.password.value;\n\n        if (this.isArchive) {\n          store.commit(\"setMessages\", []);\n          this.getData();\n          setTimeout(function () {\n            self.initializeEmoji();\n          }, 500);\n        }\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    showBookmarkedMessages: async function () {\n      store.commit(\"setMessages\", []);\n\n      if (this.isShowingBookmarked) {\n        this.page = 0;\n        this.getData();\n        this.isShowingBookmarked = false;\n      } else {\n        const formData = new FormData();\n        formData.append(\"email\", this.email);\n        formData.append(\"password\", this.password);\n        const response = await axios.post(this.$apiURL + \"/chat/getBookmarked\", formData, {\n          headers: this.$headers\n        });\n\n        if (response.data.status == \"success\") {\n          for (let a = 0; a < response.data.data.length; a++) {\n            store.commit(\"prependMessage\", response.data.data[a]);\n          }\n\n          this.attachEventListeners();\n        } else {\n          swal.fire(\"Error\", response.data.message, \"error\");\n        }\n\n        this.isShowingBookmarked = true;\n      }\n    },\n    copyMessage: function () {\n      navigator.clipboard.writeText(this.selectedMessageText);\n    },\n    bookmarkMessage: async function () {\n      const target = event.target;\n      const formData = new FormData();\n      formData.append(\"_id\", this.selectedMessageId);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/bookmark\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        for (let a = 0; a < this.messages.length; a++) {\n          if (this.messages[a]._id == this.selectedMessageId) {\n            this.messages[a] = response.data.newMessage;\n            break;\n          }\n        }\n\n        store.commit(\"setMessages\", this.messages);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    hideMoreOptions: function () {\n      document.getElementById(\"contextMenu\").style.display = \"none\";\n    },\n    showMoreOptions: function (msg) {\n      const isMyMessage = event.target.getAttribute(\"is-my-message\");\n      this.selectedMessageId = msg._id;\n      this.selectedMessageText = msg.message;\n      var menu = document.getElementById(\"contextMenu\");\n      menu.style.display = 'block';\n\n      if (isMyMessage == \"true\") {\n        menu.style.left = event.pageX - 200 + \"px\";\n      } else {\n        menu.style.left = event.pageX + \"px\";\n      }\n\n      menu.style.top = event.pageY + \"px\";\n      document.querySelector(\".bookmark i\").className = \"fa fa-bookmark-o\";\n\n      if (msg.bookmarkBy) {\n        document.querySelector(\".bookmark i\").className = \"fa fa-bookmark\";\n      }\n    },\n    attachEventListeners: function () {\n      const self = this;\n      document.addEventListener('click', function (e) {\n        const moreOptions = document.querySelectorAll(\".more-options\");\n        let isClickedMoreOptions = true;\n\n        for (let a = 0; a < moreOptions.length; a++) {\n          if (moreOptions[a].contains(e.target)) {\n            // Clicked in box\n            isClickedMoreOptions = true;\n            break;\n          } else {\n            // Clicked outside the box\n            isClickedMoreOptions = false;\n          }\n        }\n\n        if (!isClickedMoreOptions) {\n          self.hideMoreOptions();\n        }\n      });\n    },\n    getChatPersonPicture: function (user) {\n      if (typeof user.picture !== \"undefined\" && user.picture != \"\") {\n        return this.$apiURL + \"/\" + user.picture;\n      }\n\n      return \"../../assets/img/avatar2.png\";\n    },\n    getPicture: function (user) {\n      if (typeof user.picture !== \"undefined\") {\n        return this.$apiURL + \"/\" + user.picture;\n      }\n\n      return \"../../assets/img/avatar7.png\";\n    },\n    doSearch: async function () {\n      const form = event.target;\n      const formData = new FormData(form);\n      formData.append(\"email\", this.email);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/search\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        store.commit(\"setMessages\", []);\n\n        for (let a = 0; a < response.data.data.length; a++) {\n          store.commit(\"prependMessage\", response.data.data[a]);\n        }\n\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    downloadAttachment: async function () {\n      const anchor = event.target;\n      const id = anchor.getAttribute(\"data-id\");\n      const originalHtml = anchor.innerHTML;\n      anchor.innerHTML = \"Loading...\";\n      const formData = new FormData();\n      formData.append(\"messageId\", id);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/attachment\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        this.base64Str = response.data.base64Str;\n        this.downloadFileName = response.data.fileName;\n        const btnDownloadAttachment = this.$refs[\"btnDownloadAttachment\"];\n        setTimeout(function () {\n          btnDownloadAttachment.click();\n          anchor.innerHTML = originalHtml;\n        }, 500);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    fileSelected: function () {\n      const files = event.target.files;\n\n      if (files.length > 0) {\n        this.attachment = files[0];\n      }\n    },\n    selectFile: function () {\n      document.getElementById(\"attachment\").click();\n    },\n    getMessageTime: function (time) {\n      const dateObj = new Date(time);\n      let timeStr = dateObj.getFullYear() + \"-\" + (dateObj.getMonth() + 1) + \"-\" + dateObj.getDate() + \" \" + dateObj.getHours() + \":\" + dateObj.getMinutes() + \":\" + dateObj.getSeconds();\n      return timeStr;\n    },\n    loadMore: function () {\n      this.btnLoadMoreClass = \"fa fa-spinner fa-spin\";\n      this.page++;\n      this.getData();\n    },\n    getData: async function () {\n      if (this.email == null) {\n        return;\n      }\n\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"page\", this.page);\n      formData.append(\"password\", this.password);\n      const response = await axios.post(this.$apiURL + \"/chat/fetch\", formData, {\n        headers: this.$headers\n      });\n      this.btnLoadMoreClass = \"fa fa-repeat\";\n\n      if (response.data.status == \"success\") {\n        for (let a = 0; a < response.data.messages.length; a++) {\n          store.commit(\"prependMessage\", response.data.messages[a]);\n        }\n\n        this.hasMoreMessages = response.data.messages.length == 0 ? false : true;\n        this.receiver = response.data.receiver;\n        this.user = response.data.user;\n        this.isArchive = response.data.isArchive;\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    sendMessage: async function () {\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"message\", this.message);\n      formData.append(\"password\", this.password);\n\n      if (this.attachment != null) {\n        formData.append(\"attachment\", this.attachment);\n      }\n\n      const response = await axios.post(this.$apiURL + \"/chat/send\", formData, {\n        headers: this.$headers\n      });\n\n      if (response.data.status == \"success\") {\n        this.message = \"\";\n        this.attachment = null;\n        document.getElementById(\"attachment\").value = null;\n        store.commit(\"appendMessage\", response.data.messageObject);\n        this.attachEventListeners();\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    initializeEmoji: function () {\n      const self = this;\n      $(\"#emojis\").disMojiPicker();\n      twemoji.parse(document.body);\n      $(\"#emojis\").picker(function (emoji) {\n        self.message += emoji;\n      });\n    }\n  },\n\n  mounted() {\n    this.getData();\n    this.initializeEmoji();\n    /*document.addEventListener(\"click\", function () {\n    \tself.hideMoreOptions()\n    })\n         \t\tdocument.oncontextmenu = function () {\n        \t\t\tevent.preventDefault()\n               if (document.getElementById(\"contextMenu\").style.display == \"block\"){ \n                  hideMenu(); \n              }else{ \n                  var menu = document.getElementById(\"contextMenu\")      \n                  menu.style.display = 'block'; \n                  menu.style.left = event.pageX + \"px\"; \n                  menu.style.top = event.pageY + \"px\"; \n              }\n        \t\t}*/\n  },\n\n  watch: {\n    $route: function (to, from) {\n      if (from.href.includes(\"/chat/\")) {\n        store.commit(\"setMessages\", []);\n      }\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","swal","store","data","attachment","message","email","$route","params","page","receiver","base64Str","downloadFileName","btnLoadMoreClass","hasMoreMessages","selectedMessageId","selectedMessageText","isShowingBookmarked","isArchive","password","computed","messages","getters","getMessages","methods","verifyArchivedPassword","self","form","event","target","formData","FormData","append","response","post","$apiURL","headers","$headers","status","value","commit","getData","setTimeout","initializeEmoji","fire","showBookmarkedMessages","a","length","attachEventListeners","copyMessage","navigator","clipboard","writeText","bookmarkMessage","_id","newMessage","hideMoreOptions","document","getElementById","style","display","showMoreOptions","msg","isMyMessage","getAttribute","menu","left","pageX","top","pageY","querySelector","className","bookmarkBy","addEventListener","e","moreOptions","querySelectorAll","isClickedMoreOptions","contains","getChatPersonPicture","user","picture","getPicture","doSearch","downloadAttachment","anchor","id","originalHtml","innerHTML","fileName","btnDownloadAttachment","$refs","click","fileSelected","files","selectFile","getMessageTime","time","dateObj","Date","timeStr","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","loadMore","sendMessage","messageObject","$","disMojiPicker","twemoji","parse","body","picker","emoji","mounted","watch","to","from","href","includes"],"sourceRoot":"","sources":["D:\\Download\\Compressed\\chat-station-mevn-free\\web\\src\\components\\ChatComponent.vue"],"sourcesContent":["<template>\n\t<div class=\"container\">\n\t\t<div class=\"row clearfix\">\n\t\t\t<div class=\"col-lg-12\">\n\n\t\t\t\t<div class=\"card\" v-if=\"isArchive\">\n\t\t\t\t\t<div class=\"card-body\">\n\t\t\t\t\t\t<h2 class=\"text-center\" style=\"margin-top: 20px;\">This chat has been archived</h2>\n\n\t\t\t\t\t\t<div class=\"row\" style=\"margin-top: 100px; margin-bottom: 100px;\">\n\t\t\t\t\t\t\t<div class=\"offset-md-4 col-md-4\">\n\t\t\t\t\t\t\t\t<form v-on:submit.prevent=\"verifyArchivedPassword\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\" style=\"margin-bottom: 10px;\">\n\t\t\t\t\t\t\t\t\t\t<label>Enter password</label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"password\" name=\"password\" class=\"form-control\" required style=\"margin-top: 10px;\" />\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<input type=\"submit\" class=\"btn btn-danger\" value=\"Open chat\" />\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"card chat-app\" v-if=\"!isArchive\">\n\t\t\t\t\t<div class=\"chat\">\n\t\t\t\t\t\t<div class=\"chat-header clearfix\">\n\t\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t\t<div class=\"col-lg-6\">\n\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0);\" data-toggle=\"modal\" data-target=\"#view_info\">\n\t\t\t\t\t\t\t\t\t\t<img v-if=\"receiver != null\" v-bind:src=\"getChatPersonPicture(receiver)\" alt=\"avatar\" style=\"width: 50px;\" />\n\t\t\t\t\t\t\t\t\t</a>\n\n\t\t\t\t\t\t\t\t\t<div class=\"chat-about\">\n\t\t\t\t\t\t\t\t\t\t<h6 class=\"m-b-0 text-white\" v-if=\"receiver != null\" v-text=\"receiver.name\" style=\"margin-bottom: 0px; position: relative; top: 10px;\"></h6>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"col-lg-6 hidden-sm text-right text-white\">\n\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-primary\" style=\"margin-right: 10px;\" v-on:click=\"showBookmarkedMessages\" v-text=\"isShowingBookmarked ? 'All messages' : 'Bookmarked messages'\"></button>\n\n\t\t\t\t\t\t\t\t\t<form style=\"display: inline-block;\" v-on:submit.prevent=\"doSearch\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\" style=\"display: flex;\">\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"search\" name=\"search\" autocomplete=\"off\" />\n\t\t\t\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"btn btn-link\">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-search\"></i>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</form>\n\n\t\t\t\t\t\t\t\t\t<span v-if=\"attachment != null\" style=\"margin-right: 10px; position: relative; top: 7px;\" v-text=\"attachment.name\"></span>\n\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0);\" class=\"btn btn-outline-secondary pull-right text-white\" v-on:click=\"selectFile\"><i class=\"fa fa-paperclip\"></i></a>\n\t\t\t\t\t\t\t\t\t<input type=\"file\" id=\"attachment\" style=\"display: none;\" v-on:change=\"fileSelected\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"chat-history\">\n\t\t\t\t\t\t\t<ul class=\"m-b-0\">\n\t\t\t\t\t\t\t\t<li style=\"text-align: center;\">\n\t\t\t\t\t\t\t\t\t<i v-bind:class=\"btnLoadMoreClass + ' btnLoadMore'\" v-on:click=\"loadMore\" v-if=\"hasMoreMessages\"></i>\n\t\t\t\t\t\t\t\t</li>\n\n\t\t\t\t\t\t\t\t<li v-for=\"msg in messages\" class=\"clearfix\" v-bind:key=\"msg._id\">\n\t\t\t\t\t\t\t\t\t<div class=\"more-options\" v-on:click=\"showMoreOptions(msg)\" v-bind:is-my-message=\"(user != null && user.email == msg.sender.email)\" v-bind:style=\"(user != null && user.email == msg.sender.email) ? { 'float': 'right' } : { 'position': 'relative', 'top': '15px' }\"></div>\n\n\t\t\t\t\t\t\t\t\t<div v-bind:class=\"'message ' + (user != null && user.email == msg.sender.email ? 'my-message float-right' : 'other-message')\">\n\t\t\t\t\t\t\t\t\t\t<p v-text=\"msg.message\" v-bind:class=\"(user != null && user.email == msg.sender.email ? 'text-right' : '')\" style=\"margin-bottom: 0px;\"></p>\n\n\t\t\t\t\t\t\t\t\t\t<template v-if=\"msg.attachment != null\">\n\t\t\t\t\t\t\t\t\t\t    <a href=\"javascript:void(0)\" v-bind:data-id=\"msg._id\" v-on:click.prevent=\"downloadAttachment\" v-text=\"msg.attachment.displayName\" class=\"text-info\" target=\"_blank\"></a>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div v-bind:class=\"'message-data ' + (user != null && user.email == msg.sender.email ? 'float-right' : '')\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"message-data-time text-white\" v-text=\"getMessageTime(msg.createdAt)\" style=\"margin-right: 10px;\"></span>\n\t\t\t\t\t\t\t\t\t\t<img v-bind:src=\"getPicture(msg.sender)\" alt=\"avatar\" style=\"width: 100px;\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"chat-message clearfix\">\n\t\t\t\t\t\t\t<div class=\"input-group mb-0\">\n\t\t\t\t\t\t\t\t<div class=\"input-group mb-3\">\n\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control send-message\" placeholder=\"Enter text here...\" v-model=\"message\" />\n\n\t\t\t\t\t\t\t\t\t<button class=\"btn btn-primary\" v-on:click=\"sendMessage\" type=\"button\">Send</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div id=\"emojis\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<a v-bind:href=\"base64Str\" ref=\"btnDownloadAttachment\" v-bind:download=\"downloadFileName\"></a>\n\n\t<div id=\"contextMenu\" class=\"context-menu\" style=\"display: none\"> \n        <ul class=\"menu\"> \n            <li class=\"copy\"><a href=\"javascript:void(0)\" v-on:click=\"copyMessage\"><i class=\"fa fa-copy\" aria-hidden=\"true\"></i> Copy</a></li>\n\n            <li class=\"bookmark\"><a href=\"javascript:void(0)\" v-on:click=\"bookmarkMessage\"><i class=\"fa fa-bookmark-o\" aria-hidden=\"true\"></i> Bookmark</a></li>\n        </ul> \n    </div>\n</template>\n\n<script>\n\n\timport \"../../public/assets/css/chat.css\"\n\timport \"../../public/assets/emoji/emojis.css\"\n\timport \"../../public/assets/emoji/DisMojiPicker.js\"\n\t\n\timport axios from \"axios\"\n\timport swal from \"sweetalert2\"\n\timport store from \"../vuex/store\"\n\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tattachment: null,\n\t\t\t\tmessage: \"\",\n\t\t\t\temail: this.$route.params.email,\n\t\t\t\tpage: 0,\n\t\t\t\treceiver: null,\n\t\t\t\tbase64Str: \"\",\n\t\t\t\tdownloadFileName: \"\",\n\t\t\t\tbtnLoadMoreClass: \"fa fa-repeat\",\n\t\t\t\thasMoreMessages: true,\n\t\t\t\tselectedMessageId: 0,\n\t\t\t\tselectedMessageText: \"\",\n\t\t\t\tisShowingBookmarked: false,\n\t\t\t\tisArchive: false,\n\t\t\t\tpassword: \"\"\n\t\t\t}\n\t\t},\n\n\t\tcomputed: {\n\t\t    messages() {\n\t\t        return store.getters.getMessages\n\t\t    }\n\t\t},\n\n\t\tmethods: {\n\n\t\t\tverifyArchivedPassword: async function () {\n\t\t\t\tconst self = this\n\t\t\t\tconst form = event.target\n\t\t\t\tconst formData = new FormData(form)\n\t\t\t\tformData.append(\"email\", this.email)\n\t\t\t    \n\t\t\t    const response = await axios.post(\n\t\t\t        this.$apiURL + \"/chat/verifyArchivedPassword\",\n\t\t\t        formData,\n\t\t\t        {\n\t\t\t            headers: this.$headers\n\t\t\t        }\n\t\t\t    )\n\n\t\t\t    if (response.data.status == \"success\") {\n\t\t\t    \tthis.isArchive = response.data.isArchive\n\t\t\t    \tthis.password = form.password.value\n\n\t\t\t    \tif (this.isArchive) {\n\t\t\t    \t\tstore.commit(\"setMessages\", [])\n\t\t\t\t    \tthis.getData()\n\n\t\t\t\t    \tsetTimeout(function () {\n\t\t\t\t    \t\tself.initializeEmoji()\n\t\t\t\t    \t}, 500)\n\t\t\t\t    }\n\t\t\t    } else {\n\t\t\t        swal.fire(\"Error\", response.data.message, \"error\")\n\t\t\t    }\n\t\t\t},\n\n\t\t\tshowBookmarkedMessages: async function () {\n\t\t\t\tstore.commit(\"setMessages\", [])\n\n\t\t\t\tif (this.isShowingBookmarked) {\n\t\t\t\t\tthis.page = 0\n\t\t\t\t\tthis.getData()\n\t\t\t\t\tthis.isShowingBookmarked = false\n\t\t\t\t} else {\n\t\t\t\t\tconst formData = new FormData()\n\t\t\t\t\tformData.append(\"email\", this.email)\n\t\t\t\t\tformData.append(\"password\", this.password)\n\t\t\t\t    \n\t\t\t\t    const response = await axios.post(\n\t\t\t\t        this.$apiURL + \"/chat/getBookmarked\",\n\t\t\t\t        formData,\n\t\t\t\t        {\n\t\t\t\t            headers: this.$headers\n\t\t\t\t        }\n\t\t\t\t    )\n\n\t\t\t\t    if (response.data.status == \"success\") {\n\t\t\t\t    \tfor (let a = 0; a < response.data.data.length; a++) {\n\t\t\t\t\t\t\tstore.commit(\"prependMessage\", response.data.data[a])\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.attachEventListeners()\n\t\t\t\t    } else {\n\t\t\t\t        swal.fire(\"Error\", response.data.message, \"error\")\n\t\t\t\t    }\n\n\t\t\t\t    this.isShowingBookmarked = true\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcopyMessage: function() {\n\t\t\t\tnavigator.clipboard.writeText(this.selectedMessageText)\n\t\t\t},\n\n\t\t\tbookmarkMessage: async function() {\n\t\t\t\tconst target = event.target\n\t\t\t\tconst formData = new FormData()\n\t\t\t\tformData.append(\"_id\", this.selectedMessageId)\n\t\t\t\tformData.append(\"password\", this.password)\n\t\t\t    \n\t\t\t    const response = await axios.post(\n\t\t\t        this.$apiURL + \"/chat/bookmark\",\n\t\t\t        formData,\n\t\t\t        {\n\t\t\t            headers: this.$headers\n\t\t\t        }\n\t\t\t    )\n\n\t\t\t    if (response.data.status == \"success\") {\n\t\t\t    \tfor (let a = 0; a < this.messages.length; a++) {\n\t\t\t    \t\tif (this.messages[a]._id == this.selectedMessageId) {\n\t\t\t    \t\t\tthis.messages[a] = response.data.newMessage\n\t\t\t    \t\t\tbreak\n\t\t\t    \t\t}\n\t\t\t    \t}\n\t\t\t    \tstore.commit(\"setMessages\", this.messages)\n\t\t\t    } else {\n\t\t\t        swal.fire(\"Error\", response.data.message, \"error\")\n\t\t\t    }\n\t\t\t},\n\n\t\t\thideMoreOptions: function () {\n\t\t\t\tdocument.getElementById(\"contextMenu\").style.display = \"none\"\n\t\t\t},\n\n\t\t\tshowMoreOptions: function (msg) {\n\t\t\t\tconst isMyMessage = event.target.getAttribute(\"is-my-message\")\n\t\t\t\tthis.selectedMessageId = msg._id\n\t\t\t\tthis.selectedMessageText = msg.message\n\t\t\t\t\n\t\t\t\tvar menu = document.getElementById(\"contextMenu\")\n                menu.style.display = 'block'\n                if (isMyMessage == \"true\") {\n                \tmenu.style.left = (event.pageX - 200) + \"px\"\n                } else {\n                \tmenu.style.left = event.pageX + \"px\"\n                }\n                menu.style.top = event.pageY + \"px\"\n\n                document.querySelector(\".bookmark i\").className = \"fa fa-bookmark-o\"\n\n                if (msg.bookmarkBy) {\n                \tdocument.querySelector(\".bookmark i\").className = \"fa fa-bookmark\"\n                }\n\t\t\t},\n\n\t\t\tattachEventListeners: function() {\n\t\t\t\tconst self = this\n\n\t\t\t\tdocument.addEventListener('click', function(e) {\n\t\t\t\t\tconst moreOptions = document.querySelectorAll(\".more-options\")\n\t\t\t\t\tlet isClickedMoreOptions = true\n\t\t\t\t\tfor (let a = 0; a < moreOptions.length; a++) {\n\t\t\t\t\t\tif (moreOptions[a].contains(e.target)) {\n\t\t\t\t\t\t\t// Clicked in box\n\t\t\t\t\t\t\tisClickedMoreOptions = true\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Clicked outside the box\n\t\t\t\t\t\t\tisClickedMoreOptions = false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!isClickedMoreOptions) {\n\t\t\t\t\t\tself.hideMoreOptions()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tgetChatPersonPicture: function (user) {\n\t\t\t\tif (typeof user.picture !== \"undefined\" && user.picture != \"\") {\n\t\t\t\t\treturn this.$apiURL + \"/\" + user.picture\n\t\t\t\t}\n\t\t\t\treturn \"../../assets/img/avatar2.png\"\n\t\t\t},\n\n\t\t\tgetPicture: function (user) {\n\t\t\t\tif (typeof user.picture !== \"undefined\") {\n\t\t\t\t\treturn this.$apiURL + \"/\" + user.picture\n\t\t\t\t}\n\t\t\t\treturn \"../../assets/img/avatar7.png\"\n\t\t\t},\n\n\t\t\tdoSearch: async function () {\n\t\t\t\tconst form = event.target\n\t\t\t\tconst formData = new FormData(form)\n\t\t\t\tformData.append(\"email\", this.email)\n\t\t\t\tformData.append(\"password\", this.password)\n\t\t\t    \n\t\t\t    const response = await axios.post(\n\t\t\t        this.$apiURL + \"/chat/search\",\n\t\t\t        formData,\n\t\t\t        {\n\t\t\t            headers: this.$headers\n\t\t\t        }\n\t\t\t    )\n\n\t\t\t    if (response.data.status == \"success\") {\n\t\t\t    \tstore.commit(\"setMessages\", [])\n\t\t\t    \tfor (let a = 0; a < response.data.data.length; a++) {\n\t\t\t\t\t\tstore.commit(\"prependMessage\", response.data.data[a])\n\t\t\t\t\t}\n\t\t\t\t\tthis.attachEventListeners()\n\t\t\t    } else {\n\t\t\t        swal.fire(\"Error\", response.data.message, \"error\")\n\t\t\t    }\n\t\t\t},\n\n\t\t\tdownloadAttachment: async function () {\n\t\t\t    const anchor = event.target\n\t\t\t    const id = anchor.getAttribute(\"data-id\")\n\t\t\t    const originalHtml = anchor.innerHTML\n\t\t\t    anchor.innerHTML = \"Loading...\"\n\n\t\t\t    const formData = new FormData()\n\t\t\t    formData.append(\"messageId\", id)\n\t\t\t    formData.append(\"password\", this.password)\n\t\t\t    \n\t\t\t    const response = await axios.post(\n\t\t\t        this.$apiURL + \"/chat/attachment\",\n\t\t\t        formData,\n\t\t\t        {\n\t\t\t            headers: this.$headers\n\t\t\t        }\n\t\t\t    )\n\n\t\t\t    if (response.data.status == \"success\") {\n\t\t\t        this.base64Str = response.data.base64Str\n\t\t\t        this.downloadFileName = response.data.fileName\n\t\t\t        \n\t\t\t        const btnDownloadAttachment = this.$refs[\"btnDownloadAttachment\"]\n\t\t\t        setTimeout(function () {\n\t\t\t            btnDownloadAttachment.click()\n\t\t\t            anchor.innerHTML = originalHtml\n\t\t\t        }, 500)\n\t\t\t    } else {\n\t\t\t        swal.fire(\"Error\", response.data.message, \"error\")\n\t\t\t    }\n\t\t\t},\n\n\t\t\tfileSelected: function () {\n\t\t\t\tconst files = event.target.files\n\t\t\t\tif (files.length > 0) {\n\t\t\t\t\tthis.attachment = files[0]\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tselectFile: function () {\n\t\t\t\tdocument.getElementById(\"attachment\").click()\n\t\t\t},\n\n\t\t\tgetMessageTime: function (time) {\n\t\t\t\tconst dateObj = new Date(time)\n\t\t\t\tlet timeStr = dateObj.getFullYear() + \"-\" + (dateObj.getMonth() + 1) + \"-\" + dateObj.getDate() + \" \" + dateObj.getHours() + \":\" + dateObj.getMinutes() + \":\" + dateObj.getSeconds()\n\t\t\t\treturn timeStr\n\t\t\t},\n\n\t\t\tloadMore: function () {\n\t\t\t\tthis.btnLoadMoreClass = \"fa fa-spinner fa-spin\"\n\t\t\t\tthis.page++\n\t\t\t\tthis.getData()\n\t\t\t},\n\n\t\t\tgetData: async function () {\n\t\t\t\tif (this.email == null) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst formData = new FormData()\n\t\t\t\tformData.append(\"email\", this.email)\n\t\t\t\tformData.append(\"page\", this.page)\n\t\t\t\tformData.append(\"password\", this.password)\n\n\t\t\t\tconst response = await axios.post(\n\t\t\t\t\tthis.$apiURL + \"/chat/fetch\",\n\t\t\t\t\tformData,\n\t\t\t\t\t{\n\t\t\t\t\t\theaders: this.$headers\n\t\t\t\t\t}\n\t\t\t\t)\n\n\t\t\t\tthis.btnLoadMoreClass = \"fa fa-repeat\"\n\n\t\t\t\tif (response.data.status == \"success\") {\n\t\t\t\t\t\n\t\t\t\t\tfor (let a = 0; a < response.data.messages.length; a++) {\n\t\t\t\t\t\tstore.commit(\"prependMessage\", response.data.messages[a])\n\t\t\t\t\t}\n\t\t\t\t\tthis.hasMoreMessages = (response.data.messages.length == 0) ? false : true\n\t\t\t\t\tthis.receiver = response.data.receiver\n\t\t\t\t\tthis.user = response.data.user\n\t\t\t\t\tthis.isArchive = response.data.isArchive\n\t\t\t\t\tthis.attachEventListeners()\n\t\t\t\t} else {\n\t\t\t\t\tswal.fire(\"Error\", response.data.message, \"error\")\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tsendMessage: async function () {\n\n\t\t\t\tconst formData = new FormData()\n\t\t\t\tformData.append(\"email\", this.email)\n\t\t\t\tformData.append(\"message\", this.message)\n\t\t\t\tformData.append(\"password\", this.password)\n\t\t\t\tif (this.attachment != null) {\n\t\t\t\t\tformData.append(\"attachment\", this.attachment)\n\t\t\t\t}\n\n\t\t\t\tconst response = await axios.post(\n\t\t\t\t\tthis.$apiURL + \"/chat/send\",\n\t\t\t\t\tformData,\n\t\t\t\t\t{\n\t\t\t\t\t\theaders: this.$headers\n\t\t\t\t\t}\n\t\t\t\t)\n\n\t\t\t\tif (response.data.status == \"success\") {\n\t\t\t\t\tthis.message = \"\"\n\n\t\t\t\t\tthis.attachment = null\n\t\t\t\t\tdocument.getElementById(\"attachment\").value = null\n\n\t\t\t\t\tstore.commit(\"appendMessage\", response.data.messageObject)\n\t\t\t\t\tthis.attachEventListeners()\n\t\t\t\t} else {\n\t\t\t\t\tswal.fire(\"Error\", response.data.message, \"error\")\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tinitializeEmoji: function() {\n\t\t\t\tconst self = this\n\t\t\t\t$(\"#emojis\").disMojiPicker()\n\t\t\t\ttwemoji.parse(document.body)\n\t\t\t\t$(\"#emojis\").picker(function (emoji) {\n\t\t\t\t\tself.message += emoji\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\n\t\tmounted() {\n\t\t\tthis.getData()\n\t\t\tthis.initializeEmoji()\n\n\t\t\t/*document.addEventListener(\"click\", function () {\n\t\t\t\tself.hideMoreOptions()\n\t\t\t})\n\n       \t\tdocument.oncontextmenu = function () {\n       \t\t\tevent.preventDefault()\n\n\t            if (document.getElementById(\"contextMenu\").style.display == \"block\"){ \n\t                hideMenu(); \n\t            }else{ \n\t                var menu = document.getElementById(\"contextMenu\")      \n\t                menu.style.display = 'block'; \n\t                menu.style.left = event.pageX + \"px\"; \n\t                menu.style.top = event.pageY + \"px\"; \n\t            }\n       \t\t}*/\n\t\t},\n\n\t\twatch: {\n            $route: function (to, from) {\n                if (from.href.includes(\"/chat/\")) {\n                \tstore.commit(\"setMessages\", [])\n                }\n            }\n        },\n\t}\n</script>"]},"metadata":{},"sourceType":"module"}